<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Programming game with Blockly">
    <meta name="keywords" content="Blockly,phina.js">
    <meta name="author" content="EEIC">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="blockly-master/blockly_compressed.js"></script>
<script src="blockly-master/msg/js/ja.js"></script>
<script src="Lib/blocks_compressed.js"></script>
<script src="Lib/javascript_compressed.js"></script>
<script src="Lib/d3.js"></script>
<script src="phinajs/build/phina.js"></script>
<!-- bootstrapがjqueryを必要としているので（d3もjqueryに変えるかも） -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<xml id="toolbox" style="display: none; trashcan: true">
    <category name="テスト">
    <block type="controls_if"></block>
    <block type="controls_repeat_ext"></block>
    <block type="logic_compare"></block>
    <block type="math_number"></block>
    <block type="math_arithmetic"></block>
    <block type="text"></block>
    <block type="is_cliff"></block>
    <block type="text_print"></block>
    <block type="jump"></block>
    <block type="go_left"></block>
    <block type="go_right"></block>
    </category>
</xml>

<xml id="startBlock">
    <block type="run_below" id="START" x="20" y="20" deletable="false" movable="false"></block>
</xml>


<link rel="stylesheet" type="text/css" href="style.css">
<link rel="stylesheet" href="Lib/reset.css">

<script src="my-blockly-def.js"></script>
</head>


<body>
 <header class="header">
    <a href="#top" class="header-link">
    <img class="header_img" src="./images/white_bulb.png" alt="eeic">
    <div class="top-text">
      <p class="up">EEIC 五月祭展示</p>
      <p class="down">プログラミング教室</p>
    </div>
    </a>

    <!--menu-triggerをglobal-navから外す作戦あり-->
    <div class="menu-trigger">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <nav class="global-nav">
      <ul class="global-nav-list">
        <li class="nav-item"><a href="#about" class="nav">ないよう</a></li>
        <li class="nav-item"><a href="#contents" class="nav">ヒント</a></li>
        <li class="nav-item"><a href="#access" class="nav">ACCESS</a></li>
      </ul>
    </nav>
  </header>

    <div id="contents" class="factor">
        <div class="contents-wrapper">
            <div id="blocklyArea" class="mainContents col-sm-6">
            </div>
            <div id="phinaDiv" class="mainContents col-sm-6">

                <canvas id="phinaCanvas" class="mainContents">

                </canvas>
            </div>
        </div>
    </div>
    <div id="button-and-log" class="container-fluid">
        <div class="row">
            <div id="buttonArea" class="col-sm-6">
                <div id="button" class="btn btn-lg" value="stop">スタート</div>
            </div>
            <div id="alert-area" class="col-sm-6">
                
            </div>
        </div>
    </div>
<div id="blocklyDiv" style="position: absolute"></div>

<footer></footer>

<script type="text/javascript">
 let blocklyArea = document.getElementById('blocklyArea');
 let blocklyDiv = document.getElementById('blocklyDiv');
 var workspace = Blockly.inject(blocklyDiv ,
				                        {toolbox: document.getElementById('toolbox'),
                                 scrollbar: true,
                                 trashcan: true});

 var toolbox = workspace.toolbox_;


 //初めからstartblockがworkspaceに置いてあるようにする
 Blockly.Xml.domToWorkspace(document.getElementById('startBlock'),
                            workspace);

 let onresize = function(e) {
     //blocklyAreaの位置を計算する
     var element = blocklyArea;
     var x = 0;
     var y = 0;
     do {
         x += element.offsetLeft;
         y += element.offsetTop;
         element = element.offsetParent;
     } while (element);

     // Position blocklyDiv over blocklyArea.
     blocklyDiv.style.left = x + 'px';
     blocklyDiv.style.top = y + 'px';
     blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
     blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';

     const div_w = blocklyArea.offsetWidth;



 };
 let initsvg = function(){
     onresize();
     Blockly.svgResize(workspace);
     let scrollbarDoms = [];
     scrollbarDoms.push.apply(scrollbarDoms, document.getElementsByClassName('blocklyScrollbarVertical'));
     scrollbarDoms.push.apply(scrollbarDoms, document.getElementsByClassName('blocklyScrollbarHorizontal'));
     scrollbarDoms.forEach(dom => dom.setAttribute('display', 'none'));
     scrollbarDoms.forEach(dom => dom.setAttribute('display', 'block'));
     Blockly.svgResize(workspace);
 }
 //resize時に呼ばれるように
 window.addEventListener('resize', onresize, false);
 setTimeout(initsvg, 300);



 //ボタンを押したらBlocklyでゲームを動かすかどうかを切り替える
 var button = d3.select("#button");

 button.on("click", function(e) {
     if(button.attr("value") === "running") {
         button.attr("value", "stop")
               .text("スタート");
     } else {
         button.attr("value", "running")
               .text("リセット");
     }
 });

</script>

<script src="my-phina-app.js"></script>
</body>
</html>
